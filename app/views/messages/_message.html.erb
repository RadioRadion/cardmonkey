<div class="message <%= message.user == current_user ? 'flex justify-end' : 'flex justify-start' %>"
     id="message_<%= message.id %>">
  <div class="<%= message.user == current_user ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-900' %> 
              rounded-lg px-4 py-2 max-w-[70%] break-words relative group">
    <% unless message.user == current_user %>
      <div class="text-xs text-gray-500 mb-1">
        <%= message.user.username %>
      </div>
    <% end %>
    
    <% if message.trade_message? %>
      <div class="flex flex-col space-y-2">
        <div class="font-medium"><%= message.display_content %></div>
        <%= link_to "Voir le trade", trade_path(message.trade_id), 
            class: "#{message.user == current_user ? 'bg-white text-blue-500' : 'bg-blue-500 text-white'} 
                   px-4 py-2 rounded-lg inline-block hover:opacity-90 transition-opacity text-center" %>
      </div>
    <% else %>
      <%= message.content %>
    <% end %>
    
    <div class="text-xs <%= message.user == current_user ? 'text-blue-100' : 'text-gray-500' %> mt-1">
      <%= message.timestamp %>
      <% if message.user == current_user %>
        <span class="ml-2">
          <i class="fas fa-check-double" title="Delivered"></i>
          <% if message.read_at %>
            <i class="fas fa-eye ml-1" title="Read"></i>
          <% end %>
        </span>
      <% end %>
    </div>
  </div>
</div>
