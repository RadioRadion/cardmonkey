<div class="bg-white shadow-xl rounded-lg overflow-hidden">
  <div class="p-6 sm:p-8">
    <%= simple_form_for(@form,
                      as: :user_wanted_card,
                      url: form_url,
                      method: editing ? :patch : :post,
                      html: {
                        class: "w-full",
                        data: {
                          controller: "autocomplete",
                          autocomplete_type_value: "wanted"
                        }
                      }) do |f| %>
      <%= f.input :card_id, as: :hidden %>
      <%= f.input :scryfall_id, as: :hidden,
                  input_html: {
                    data: { autocomplete_target: "scryfallOracleId" }
                  } %>

      <% if @form.errors.any? %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6" role="alert">
          <strong class="font-bold"><%= t('user_wanted_cards.form.errors') %></strong>
          <ul class="mt-2 list-disc pl-5">
            <% @form.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="space-y-6">
        <% unless editing %>
          <div>
            <label for="card_name" class="block text-sm font-medium text-gray-700 mb-2">
              <%= t('user_wanted_cards.form.card_name') %>
            </label>
            <input type="text"
                   id="card_name"
                   name="card_name"
                   value="<%= @form.card_name %>"
                   placeholder="<%= t('user_wanted_cards.form.search_placeholder') %>"
                   class="block w-full px-6 py-4 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 transition duration-150 ease-in-out focus:ring-2 focus:ring-indigo-500 focus:border-transparent sm:text-sm"
                   data-action="keyup->autocomplete#search"
                   data-autocomplete-target="input">
          </div>

          <div id="card-suggestions"
               data-autocomplete-target="suggestions"
               class="suggestions-list bg-white border border-gray-200 rounded-lg shadow-sm max-h-60 overflow-y-auto">
          </div>
        <% end %>

        <div data-autocomplete-target="formFields" class="<%= editing ? '' : 'hidden' %> space-y-6">
          <div>
            <label for="card_version_id" class="block text-sm font-medium text-gray-700 mb-2">
              <%= t('user_wanted_cards.form.extension') %>
            </label>
            <%= f.input :card_version_id,
                  label: false,
                  collection: editing ? @versions : [],
                  include_blank: t('user_wanted_cards.form.any_extension'),
                  selected: @form.card_version_id,
                  label_method: ->(cv) { "#{cv.extension.name} - #{cv.extension.code}" },
                  value_method: :id,
                  input_html: { 
                    class: "block w-full px-6 py-4 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 transition duration-150 ease-in-out focus:ring-2 focus:ring-indigo-500 focus:border-transparent sm:text-sm",
                    data: { 
                      autocomplete_target: "extension"
                    }
                  } %>
          </div>

          <%= f.input :min_condition,
                      collection: UserCard.conditions.keys,
                      include_blank: true,
                      prompt: t('user_wanted_cards.form.any_condition'),
                      label_html: { class: "block text-sm font-medium text-gray-700 mb-2" },
                      input_html: {
                        class: "block w-full px-6 py-4 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 transition duration-150 ease-in-out focus:ring-2 focus:ring-indigo-500 focus:border-transparent sm:text-sm"
                      } %>

          <%= f.input :language,
                      collection: UserCard.languages.keys,
                      include_blank: true,
                      prompt: t('user_wanted_cards.form.any_language'),
                      label_html: { class: "block text-sm font-medium text-gray-700 mb-2" },
                      input_html: {
                        class: "block w-full px-6 py-4 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 transition duration-150 ease-in-out focus:ring-2 focus:ring-indigo-500 focus:border-transparent sm:text-sm"
                      } %>

          <div class="flex items-center">
            <%= f.input :foil,
                        as: :boolean,
                        wrapper_html: { class: "flex items-center" },
                        label_html: { class: "ml-2 text-sm font-medium text-gray-700" },
                        input_html: {
                          class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded transition duration-150 ease-in-out"
                        } %>
          </div>

          <%= f.input :quantity,
                      as: :integer,
                      label_html: { class: "block text-sm font-medium text-gray-700 mb-2" },
                      input_html: {
                        min: 1,
                        class: "block w-full px-6 py-4 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 transition duration-150 ease-in-out focus:ring-2 focus:ring-indigo-500 focus:border-transparent sm:text-sm"
                      } %>

          <button type="submit"
                  class="w-full flex justify-center py-4 px-6 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <%= editing ? t('user_wanted_cards.form.save_changes') : t('user_wanted_cards.form.add_card') %>
          </button>
        </div>
      </div>
    <% end %>
  </div>
</div>
